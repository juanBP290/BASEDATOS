import React, { useState, useEffect } from 'react';

const App = () => {
  // Sample data
  const initialEntries = [
    {
      id: 1,
      date: '2023-09-01',
      licensePlate: 'ABC123',
      brand: 'Coca-Cola',
      type: 'Bebida',
      product: 'Coca-Cola 2L',
      description: 'Refresco de cola',
      observations: 'En buen estado',
      supplier: 'Distribuidora ABC',
      finalStock: 50,
      price: 2.99,
    },
    {
      id: 2,
      date: '2023-09-02',
      licensePlate: 'XYZ789',
      brand: 'Pepsi',
      type: 'Bebida',
      product: 'Pepsi 2L',
      description: 'Refresco de cola',
      observations: 'En buen estado',
      supplier: 'Distribuidora XYZ',
      finalStock: 40,
      price: 2.79,
    },
    {
      id: 3,
      date: '2023-09-03',
      licensePlate: 'DEF456',
      brand: 'Detergente',
      type: 'Limpieza',
      product: 'Detergente Líquido',
      description: 'Para ropa',
      observations: 'Promoción por tiempo limitado',
      supplier: 'Suministros S.A.',
      finalStock: 25,
      price: 5.49,
    },
  ];

  const [entries, setEntries] = useState(() => {
    const savedEntries = localStorage.getItem('databaseEntries');
    return savedEntries ? JSON.parse(savedEntries) : initialEntries;
  });

  const [searchTerm, setSearchTerm] = useState('');
  const [filteredEntries, setFilteredEntries] = useState(entries);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalType, setModalType] = useState(''); // 'add', 'edit', 'import'
  const [currentEntry, setCurrentEntry] = useState(null);
  const [formData, setFormData] = useState({
    date: '',
    licensePlate: '',
    brand: '',
    type: '',
    product: '',
    description: '',
    observations: '',
    supplier: '',
    finalStock: '',
    price: '',
  });

  // Save to localStorage
  useEffect(() => {
    localStorage.setItem('databaseEntries', JSON.stringify(entries));
  }, [entries]);

  // Filter entries based on search term
  useEffect(() => {
    if (searchTerm.trim() === '') {
      setFilteredEntries(entries);
    } else {
      const term = searchTerm.toLowerCase();
      setFilteredEntries(entries.filter(entry => 
        entry.date.includes(term) ||
        entry.licensePlate.toLowerCase().includes(term) ||
        entry.brand.toLowerCase().includes(term) ||
        entry.type.toLowerCase().includes(term) ||
        entry.product.toLowerCase().includes(term) ||
        entry.description.toLowerCase().includes(term) ||
        entry.observations.toLowerCase().includes(term) ||
        entry.supplier.toLowerCase().includes(term) ||
        entry.finalStock.toString().includes(term) ||
        entry.price.toString().includes(term)
      ));
    }
  }, [searchTerm, entries]);

  const openModal = (type, entry = null) => {
    setModalType(type);
    if (type === 'edit' && entry) {
      setCurrentEntry(entry);
      setFormData(entry);
    } else {
      setFormData({
        date: '',
        licensePlate: '',
        brand: '',
        type: '',
        product: '',
        description: '',
        observations: '',
        supplier: '',
        finalStock: '',
        price: '',
      });
    }
    setIsModalOpen(true);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    setModalType('');
    setCurrentEntry(null);
  };

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({ ...prev, [name]: value }));
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    if (modalType === 'add') {
      const newEntry = {
        id: Date.now(),
        ...formData,
        finalStock: parseInt(formData.finalStock),
        price: parseFloat(formData.price),
      };
      setEntries(prev => [...prev, newEntry]);
    } else if (modalType === 'edit') {
      const updatedEntry = {
        ...currentEntry,
        ...formData,
        finalStock: parseInt(formData.finalStock),
        price: parseFloat(formData.price),
      };
      setEntries(prev => prev.map(entry => 
        entry.id === currentEntry.id ? updatedEntry : entry
      ));
    }
    closeModal();
  };

  const handleDelete = (id) => {
    if (window.confirm('¿Estás seguro de que quieres eliminar este producto?')) {
      setEntries(prev => prev.filter(entry => entry.id !== id));
    }
  };

  return (
    <div className="min-h-screen bg-gray-100">
      {/* Header */}
      <header className="bg-white shadow-sm">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
          <div className="flex justify-between items-center">
            <h1 className="text-2xl font-bold text-gray-900">Base de Datos de Productos</h1>
            <div className="flex space-x-4">
              <button 
                onClick={() => openModal('import')}
                className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md flex items-center transition-colors duration-200"
              >
                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                  <path fillRule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clipRule="evenodd" />
                </svg>
                Importar Excel
              </button>
              <button 
                onClick={() => openModal('add')}
                className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md flex items-center transition-colors duration-200"
              >
                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                  <path fillRule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clipRule="evenodd" />
                </svg>
                Nuevo Producto
              </button>
            </div>
          </div>
          
          {/* Search Bar */}
          <div className="mt-4">
            <div className="relative">
              <input
                type="text"
                placeholder="Buscar..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              />
              <div className="absolute left-3 top-2.5 text-gray-400">
                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path fillRule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clipRule="evenodd" />
                </svg>
              </div>
            </div>
          </div>
        </div>
      </header>

      {/* Main Content */}
      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div className="bg-white shadow overflow-hidden sm:rounded-lg">
          <div className="overflow-x-auto">
            <table className="min-w-full divide-y divide-gray-200">
              <thead className="bg-gray-50">
                <tr>
                  <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">FECHA</th>
                  <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">PLACA</th>
                  <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">MARCA/ANAQUEL</th>
                  <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">TIPO</th>
                  <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">PRODUCTO</th>
                  <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">DESCRIPCION</th>
                  <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">OBERVACIONES</th>
                  <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">PROVEEDOR</th>
                  <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">STOCK FINAL</th>
                  <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">PRECIO</th>
                  <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ACCIONES</th>
                </tr>
              </thead>
              <tbody className="bg-white divide-y divide-gray-200">
                {filteredEntries.length === 0 ? (
                  <tr>
                    <td colSpan="11" className="px-6 py-4 text-center text-gray-500">
                      {searchTerm.trim() === '' ? 'No hay productos en la base de datos' : 'No se encontraron resultados'}
                    </td>
                  </tr>
                ) : (
                  filteredEntries.map((entry) => (
                    <tr key={entry.id} className="hover:bg-gray-50 transition-colors duration-150">
                      <td className="px-6 py-4 whitespace-nowrap">{entry.date}</td>
                      <td className="px-6 py-4 whitespace-nowrap">{entry.licensePlate}</td>
                      <td className="px-6 py-4 whitespace-nowrap">{entry.brand}</td>
                      <td className="px-6 py-4 whitespace-nowrap">{entry.type}</td>
                      <td className="px-6 py-4 whitespace-nowrap">{entry.product}</td>
                      <td className="px-6 py-4 whitespace-nowrap">{entry.description}</td>
                      <td className="px-6 py-4 whitespace-nowrap">{entry.observations}</td>
                      <td className="px-6 py-4 whitespace-nowrap">{entry.supplier}</td>
                      <td className="px-6 py-4 whitespace-nowrap">{entry.finalStock}</td>
                      <td className="px-6 py-4 whitespace-nowrap">${entry.price.toFixed(2)}</td>
                      <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <button 
                          onClick={() => openModal('edit', entry)} 
                          className="text-indigo-600 hover:text-indigo-900 mr-3 transition-colors duration-150"
                        >
                          Editar
                        </button>
                        <button 
                          onClick={() => handleDelete(entry.id)} 
                          className="text-red-600 hover:text-red-900 transition-colors duration-150"
                        >
                          Eliminar
                        </button>
                      </td>
                    </tr>
                  ))
                )}
              </tbody>
            </table>
          </div>
        </div>
      </main>

      {/* Modal */}
      {isModalOpen && (
        <div className="fixed z-10 inset-0 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
          <div className="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div className="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true" onClick={closeModal}></div>
            <span className="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div className="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
              <div className="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                <div className="sm:flex sm:items-start">
                  <div className="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                    <h3 className="text-lg leading-6 font-medium text-gray-900" id="modal-title">
                      {modalType === 'add' && 'Agregar Nuevo Producto'}
                      {modalType === 'edit' && 'Editar Producto'}
                      {modalType === 'import' && 'Importar desde Excel'}
                    </h3>
                    <div className="mt-4">
                      {modalType === 'import' ? (
                        <div>
                          <p className="text-sm text-gray-500 mb-4">
                            Seleccione un archivo Excel (.xlsx) para importar productos.
                          </p>
                          <input
                            type="file"
                            accept=".xlsx, .xls"
                            className="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
                          />
                        </div>
                      ) : (
                        <form className="space-y-4" onSubmit={handleSubmit}>
                          <div className="grid grid-cols-2 gap-4">
                            <div>
                              <label htmlFor="date" className="block text-sm font-medium text-gray-700">Fecha</label>
                              <input
                                type="date"
                                id="date"
                                name="date"
                                value={formData.date}
                                onChange={handleInputChange}
                                className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                              />
                            </div>
                            <div>
                              <label htmlFor="licensePlate" className="block text-sm font-medium text-gray-700">Placa</label>
                              <input
                                type="text"
                                id="licensePlate"
                                name="licensePlate"
                                value={formData.licensePlate}
                                onChange={handleInputChange}
                                className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                              />
                            </div>
                          </div>
                          <div>
                            <label htmlFor="brand" className="block text-sm font-medium text-gray-700">Marca/Anaquel</label>
                            <input
                              type="text"
                              id="brand"
                              name="brand"
                              value={formData.brand}
                              onChange={handleInputChange}
                              className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                            />
                          </div>
                          <div>
                            <label htmlFor="type" className="block text-sm font-medium text-gray-700">Tipo</label>
                            <input
                              type="text"
                              id="type"
                              name="type"
                              value={formData.type}
                              onChange={handleInputChange}
                              className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                            />
                          </div>
                          <div>
                            <label htmlFor="product" className="block text-sm font-medium text-gray-700">Producto</label>
                            <input
                              type="text"
                              id="product"
                              name="product"
                              value={formData.product}
                              onChange={handleInputChange}
                              className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                            />
                          </div>
                          <div>
                            <label htmlFor="description" className="block text-sm font-medium text-gray-700">Descripción</label>
                            <textarea
                              id="description"
                              name="description"
                              rows="3"
                              value={formData.description}
                              onChange={handleInputChange}
                              className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                            ></textarea>
                          </div>
                          <div>
                            <label htmlFor="observations" className="block text-sm font-medium text-gray-700">Observaciones</label>
                            <textarea
                              id="observations"
                              name="observations"
                              rows="3"
                              value={formData.observations}
                              onChange={handleInputChange}
                              className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                            ></textarea>
                          </div>
                          <div>
                            <label htmlFor="supplier" className="block text-sm font-medium text-gray-700">Proveedor</label>
                            <input
                              type="text"
                              id="supplier"
                              name="supplier"
                              value={formData.supplier}
                              onChange={handleInputChange}
                              className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                            />
                          </div>
                          <div className="grid grid-cols-2 gap-4">
                            <div>
                              <label htmlFor="finalStock" className="block text-sm font-medium text-gray-700">Stock Final</label>
                              <input
                                type="number"
                                id="finalStock"
                                name="finalStock"
                                value={formData.finalStock}
                                onChange={handleInputChange}
                                className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                              />
                            </div>
                            <div>
                              <label htmlFor="price" className="block text-sm font-medium text-gray-700">Precio</label>
                              <input
                                type="number"
                                id="price"
                                name="price"
                                step="0.01"
                                value={formData.price}
                                onChange={handleInputChange}
                                className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                              />
                            </div>
                          </div>
                        </form>
                      )}
                    </div>
                  </div>
                </div>
              </div>
              <div className="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                <button
                  type="button"
                  className="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm transition-colors duration-150"
                  onClick={handleSubmit}
                >
                  {modalType === 'import' ? 'Importar' : 'Guardar'}
                </button>
                <button
                  type="button"
                  className="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm transition-colors duration-150"
                  onClick={closeModal}
                >
                  Cancelar
                </button>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default App;
